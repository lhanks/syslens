#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

usage() {
    echo "Usage: $0 <target>"
    echo ""
    echo "Targets:"
    echo "  local    Build release for local installation"
    echo "  release  Build release artifacts for distribution"
    echo ""
    echo "Note: Syslens is a desktop app. 'Deploy' creates distributable packages."
    exit 1
}

if [[ $# -lt 1 ]]; then
    usage
fi

TARGET="$1"

case "$TARGET" in
    local)
        echo "Building release for local installation..."
        "$SCRIPT_DIR/build" --release
        echo ""
        echo "Release build complete!"
        echo "Installer available at: projects/backend/target/release/bundle/"
        ;;
    release)
        echo "Building release artifacts..."
        cd "$PROJECT_ROOT/projects/backend"
        cargo tauri build
        echo ""
        echo "Release artifacts available at: projects/backend/target/release/bundle/"
        ;;
    *)
        usage
        ;;
esac
