#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"
WEBSITE_DIR="$PROJECT_ROOT/projects/website"

usage() {
    echo "Usage: $0 [options]"
    echo ""
    echo "Options:"
    echo "  --prod     Deploy to production"
    echo "  --preview  Deploy preview (default)"
    echo ""
    echo "Requires Vercel CLI: npm i -g vercel"
    exit 1
}

# Check for vercel CLI
if ! command -v vercel &> /dev/null; then
    echo "ERROR: Vercel CLI not found."
    echo ""
    echo "Install with: npm i -g vercel"
    echo ""
    exit 1
fi

TARGET="preview"
if [[ "${1:-}" == "--prod" ]]; then
    TARGET="production"
elif [[ "${1:-}" == "--help" ]] || [[ "${1:-}" == "-h" ]]; then
    usage
fi

echo "Deploying website to Vercel ($TARGET)..."
echo ""

cd "$WEBSITE_DIR"

if [[ "$TARGET" == "production" ]]; then
    vercel --prod
else
    vercel
fi

echo ""
echo "Deployment complete!"
