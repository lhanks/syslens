#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"
BACKEND_DIR="$PROJECT_ROOT/projects/backend"

# Check for cargo
if ! command -v cargo &> /dev/null; then
    echo "ERROR: Rust/Cargo not found."
    echo ""
    echo "Install Rust:"
    echo "  Windows: winget install Rustlang.Rustup"
    echo "  Or visit: https://rustup.rs"
    echo ""
    echo "After installing, restart your terminal and run this script again."
    exit 1
fi

echo "Building backend (Tauri/Rust)..."

cd "$BACKEND_DIR"

if [[ "${1:-}" == "--release" ]]; then
    cargo tauri build
else
    cargo build
fi

echo "Backend build complete!"
